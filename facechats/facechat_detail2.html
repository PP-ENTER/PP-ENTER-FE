<!DOCTYPE html>
<html>

  <head>
    <title>Simple WebRTC Example</title>
  </head>

  <body>
    <div id="videoContainer"></div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        if (navigator.mediaDevices.getUserMedia) {
          navigator
            .mediaDevices
            .getUserMedia({video: true, audio: true})
            .then(stream => {
              // 자신의 스트림을 화면에 추가
              addVideoStream(stream);

              // WebRTC 피어 연결 설정 (간단한 예제로, 실제 통신을 위해선 시그널링 로직 필요)
              const peerConnection = new RTCPeerConnection();

              // 스트림 트랙을 피어 연결에 추가
              stream
                .getTracks()
                .forEach(track => {
                  peerConnection.addTrack(track, stream);
                });

              // 원격 스트림 수신 대기
              peerConnection.ontrack = event => {
                addVideoStream(event.streams[0]);
              };

              // Offer 생성 및 설정
              peerConnection
                .createOffer()
                .then(sdp => peerConnection.setLocalDescription(sdp))
                .then(() => {
                  // 여기에서 생성된 Offer SDP를 시그널링 서버를 통해 다른 피어에게 전송
                  // 예제에서는 이 부분을 생략합니다.
                });
            })
            .catch(error => {
              console.error('Failed to get local stream', error);
            });
        }
      });

      function addVideoStream(stream) {
        const videoContainer = document.getElementById('videoContainer');
        const videoElement = document.createElement('video');
        videoElement.srcObject = stream;
        videoElement.autoplay = true;
        videoElement.controls = true; // 필요한 경우 컨트롤러 추가

        videoContainer.appendChild(videoElement);
      }
    </script>
  </body>

</html>
